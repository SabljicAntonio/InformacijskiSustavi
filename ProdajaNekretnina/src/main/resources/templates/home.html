<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Prodaja nekretnina</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="webjars/jquery/3.3.1"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<nav class="navbar navbar-light bg-light">
    <a class="navbar-brand">
        <span class="naslov">Nekretnine</span>
    </a>
</nav>
<input id="filterAll"></input><button onclick="filterDrzava()" class="btn btn-primary">Država</button>
<div>
    <table class="table table-hover" id="nekretnineTable">
        <thead>
        <tr>
            <th> Naziv nekretnine </th>
            <th> Adresa </th>
            <th> Površina </th>
            <th> Cijena </th>
        </tr>
        </thead>
        <tr>
            <td><input type="text" id="nazivNek" name="nazivNek"></td>
            <td><input type="text" id="adresa" name="adresa"></td>
            <td><input type="text" id="povrsina" name="povrsina"></td>
            <td><input type="text" id="cijena" name="cijena"></td>
            <td><button id="filterButtonNek" onclick="filter()" class="btn btn-primary">Filter</button></td>
        </tr>
        <tbody id="podatciNek">
        <tr th:each="nekretnina : ${nekretnine}">
            <td><span th:text="${nekretnina.getNazivNek()}"></span></td>
            <td><span th:text="${nekretnina.getAdresa()}"></span></td>
            <td><span th:text="${nekretnina.getPovrsina()}"></span></td>
            <td><span th:text="${nekretnina.getCijena()}"></span></td>
            <td style="display:none;" th:id="${nekretnina.getId()}"><p th:text="${'Ime agenta: ' + nekretnina.getAgent().getNazivAgenta()}">  </p>
                <p th:text="${'E-adresa agenta: ' + nekretnina.getAgent().getEmail()}">  </p>
                <p th:text="${'O agentu: ' + nekretnina.getAgent().getOpis()}">  </p>
                <p th:text="${'Prodanih nekretnina: ' + nekretnina.getAgent().getProdNek()}"> </p>
            </td>
            <td style="display:none;" th:text="${nekretnina.getDrzava().getNaziv()}"></td>
            <td><button th:attr="onclick='hideAgent(\'' + ${nekretnina.getId()} + '\');'" class="btn btn-primary">Agent</button></td>
        </tr>
        </tbody>
    </table>


</div>

<script>

    function filterDrzava() {
        var  table, tr, td, i, j;

        //uzimamo tekst iz text polja
        input = document.getElementById("filterAll").value.toUpperCase();

        console.log(input.toString());
        table = document.getElementById("nekretnineTable");
        tr = table.getElementsByTagName("tr");
        console.log(tr);


        // Loop through all table rows, and hide those who don't match the search query
        for (i = 2; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td"); //za svaki redak dohvati stupce

            if((input == "")
            ) {
                for(j = 2; j < tr.length+1; j++){
                    tr[j].style.display="";
                }
            }

            if((input == td[5].innerText.toUpperCase())
                ) {
                tr[i].style.display = "";
            }
            else {
                tr[i].style.display = "none";
            }
        }}

    function hideAgent(indeks)    {
        var ind = "podaciAgenta_"+indeks;
        var x = document.getElementById(indeks);
        if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
  }
    }
    function filter() {
        // Declare variables
        var input = new Array(4);
        var  table, tr, td, i, j;

        //uzimamo tekst iz text polja
        input[0] = document.getElementById("nazivNek").value.toUpperCase();
        input[1] = document.getElementById("adresa").value.toUpperCase();
        input[2] = document.getElementById("povrsina").value.toUpperCase();
        input[3] = document.getElementById("cijena").value.toUpperCase();


        console.log(input.toString());
        table = document.getElementById("nekretnineTable");
        tr = table.getElementsByTagName("tr");
        console.log(tr);


        // Loop through all table rows, and hide those who don't match the search query
        for (i = 2; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td"); //za svaki redak dohvati stupce

            if((input[0] == "") &&
                (input[1] == "") &&
                (input[2] == "") &&
                (input[3] == "") &&
                (input[4] == "")
            ) {
                for(j = 2; j < tr.length; j++){
                    tr[j].style.display="";
                }
            }

            if((input[0] == td[0].innerText.toUpperCase()) ||
                (input[1] == td[1].innerText.toUpperCase()) ||
                (input[2] == td[2].innerText.toUpperCase()) ||
                (input[3] == td[3].innerText.toUpperCase()) ||
                (input[4] == td[4].innerText.toUpperCase())
                ) {
                tr[i].style.display = "";
            }
            else {
                tr[i].style.display = "none";
            }
        }
    }

    function getAgentNek() {
        let tableAgent = document.getElementById("agentTable");
        let nazivAgent = document.getElementById("nazivAg");
        let emailAgent = document.getElementById("emailAg");
        let opisAgent = document.getElementById("opisAg");
        let prodNekAgent = document.getElementById("prodNekAg");

        let row = tableAgent.insertRow(0);

        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        let cell3 = row.insertCell(2);
        let cell4 = row.insertCell(3);


        cell1.innerText = nazivAgent.innerText;
        cell2.innerText = emailAgent.innerText;
        cell3.innerText = opisAgent.innerText;
        cell4.innerText = prodNekAgent.innerText;



    }

    function filterAll() {
        // Declare variables
        var input;
        var  table, tr, td, i, j;

        //uzimamo tekst iz text polja
        input = document.getElementById("filterAll").value.toUpperCase();

        console.log(input.toString());
        table = document.getElementById("zupanijeTable");
        tr = table.getElementsByTagName("tr");
        console.log(tr);


        // Loop through all table rows, and hide those who don't match the search query
        for (i = 2; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td"); //za svaki redak dohvati stupce

            if((input == ""))
            {
                for(j = 2; j < tr.length; j++){
                    tr[j].style.display="";
                }
            }

            if((input == td[0].innerText.toUpperCase()) ||
                (input == td[1].innerText.toUpperCase()) ||
                (input == td[2].innerText.toUpperCase()) ||
                (input == td[3].innerText.toUpperCase()) ||
                (input == td[4].innerText.toUpperCase()) ||
                (input == td[5].innerText.toUpperCase()) ||
                (input == td[6].innerText.toUpperCase()) ||
                (input == td[7].innerText.toUpperCase()) ||
                (input == td[8].innerText.toUpperCase()) ||
                (input == td[9].innerText.toUpperCase())) {
                tr[i].style.display = "";
            }
            else {
                tr[i].style.display = "none";
            }
        }
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

</body>
</html>